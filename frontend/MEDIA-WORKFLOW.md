# Media Upload and Management Workflow

**æ—¥æœŸ**: 2024-12-16  
**çŠ¶æ€**: âœ… å®Œæˆ

## ğŸ“‹ ä¸šåŠ¡æµç¨‹

### å®Œæ•´çš„åª’ä½“ç®¡ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Agent åˆ›å»º Listing                                       â”‚
â”‚     - åŸºæœ¬ä¿¡æ¯ã€åœ°å€ã€æˆ¿äº§è¯¦æƒ…                                â”‚
â”‚     - å¯é€‰ï¼šä¸Šä¼ åª’ä½“ï¼ˆå¦‚æœæœ‰ Studio æƒé™ï¼‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Agent åˆ›å»º Orderï¼ˆæ‹æ‘„è®¢å•ï¼‰                             â”‚
â”‚     - é€‰æ‹© Listing                                           â”‚
â”‚     - é€‰æ‹© Studio                                            â”‚
â”‚     - æ·»åŠ æ‹æ‘„ä»»åŠ¡                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Studio/Staff æ¥å•å¹¶å®Œæˆæ‹æ‘„                             â”‚
â”‚     - æ¥å—è®¢å•                                               â”‚
â”‚     - å¼€å§‹æ‹æ‘„                                               â”‚
â”‚     - å®Œæˆæ‹æ‘„                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Studio/Staff åˆ›å»º Delivery Package                      â”‚
â”‚     é¡µé¢: /dashboard/deliveries/new                          â”‚
â”‚     - é€‰æ‹©å·²å®Œæˆçš„ Order                                      â”‚
â”‚     - ä¸Šä¼ åª’ä½“æ–‡ä»¶ï¼ˆåˆ†ç‰‡ä¸Šä¼ ï¼‰                                â”‚
â”‚     - å‘å¸ƒ Delivery Package                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Agent æŸ¥çœ‹ Delivery å¹¶å…³è”åˆ° Listing                     â”‚
â”‚     é¡µé¢: /dashboard/listings/{id}/edit (Step 4: Media)     â”‚
â”‚     - æŸ¥çœ‹å…³è” Order çš„ Delivery Packages                    â”‚
â”‚     - é€‰æ‹© Delivery ä¸­çš„åª’ä½“æ–‡ä»¶                             â”‚
â”‚     - æ·»åŠ åˆ° Listingï¼ˆè®¾ç½®è§’è‰²ï¼šCover/Gallery/FloorPlanï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. Agent ç®¡ç† Listing åª’ä½“                                  â”‚
â”‚     - è®¾ç½®å°é¢å›¾ç‰‡                                           â”‚
â”‚     - è°ƒæ•´æ’åº                                               â”‚
â”‚     - è®¾ç½®å¯è§æ€§                                             â”‚
â”‚     - åˆ é™¤ä¸éœ€è¦çš„åª’ä½“                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ è§’è‰²æƒé™

### Studio/Staffï¼ˆæ‘„å½±å¸ˆï¼‰
âœ… **å¯ä»¥**:
- ä¸Šä¼ åª’ä½“æ–‡ä»¶ï¼ˆåˆ†ç‰‡ä¸Šä¼ ï¼‰
- åˆ›å»º Delivery Package
- ç®¡ç† Delivery Packageï¼ˆç¼–è¾‘ã€å‘å¸ƒã€æ’¤é”€ï¼‰
- æŸ¥çœ‹è‡ªå·±çš„ Deliveries

âŒ **ä¸å¯ä»¥**:
- ç›´æ¥å…³è”åª’ä½“åˆ° Listing
- ç®¡ç† Listing åª’ä½“é¡ºåºå’Œå¯è§æ€§

### Agentï¼ˆä¸­ä»‹ï¼‰
âœ… **å¯ä»¥**:
- æŸ¥çœ‹å…³è” Order çš„ Delivery Packages
- ä» Delivery ä¸­é€‰æ‹©åª’ä½“æ·»åŠ åˆ° Listing
- ç®¡ç† Listing çš„åª’ä½“ï¼ˆæ’åºã€å¯è§æ€§ã€å°é¢ï¼‰
- åˆ é™¤ Listing ä¸­çš„åª’ä½“

âŒ **ä¸å¯ä»¥**:
- ç›´æ¥ä¸Šä¼ åª’ä½“ï¼ˆé™¤éåŒæ—¶æ˜¯ Studio æˆå‘˜ï¼‰
- ä¿®æ”¹ Delivery Package

---

## ğŸ“ å®ç°çš„é¡µé¢å’Œç»„ä»¶

### 1. Deliveries åˆ—è¡¨é¡µ
**è·¯å¾„**: `/dashboard/deliveries/page.tsx`
- æ‰€æœ‰ Deliveries åˆ—è¡¨
- æœç´¢å’Œç­›é€‰ï¼ˆçŠ¶æ€ï¼‰
- Agent å’Œ Studio éƒ½å¯è®¿é—®

### 2. Delivery åˆ›å»ºé¡µ
**è·¯å¾„**: `/dashboard/deliveries/new/page.tsx`
- **ä»… Studio æˆå‘˜å¯è®¿é—®**
- é€‰æ‹©å·²å®Œæˆçš„ Order
- ä¸Šä¼ åª’ä½“æ–‡ä»¶ï¼ˆChunkedUploadï¼‰
- ä¿å­˜ä¸ºè‰ç¨¿æˆ–ç›´æ¥å‘å¸ƒ

### 3. Delivery è¯¦æƒ…é¡µ
**è·¯å¾„**: `/dashboard/deliveries/[id]/page.tsx`
- æŸ¥çœ‹ Delivery ä¿¡æ¯
- æŸ¥çœ‹åª’ä½“åˆ—è¡¨
- Studio: å¯ä»¥å‘å¸ƒ/æ’¤é”€
- Agent: åªè¯»æŸ¥çœ‹

### 4. Listing ç¼–è¾‘é¡µ - Media æ­¥éª¤
**è·¯å¾„**: `/dashboard/listings/[id]/edit/page.tsx` (Step 4)
- **Agent ä¸“ç”¨åŠŸèƒ½**
- æŸ¥çœ‹å…³è” Listing çš„ Deliveries
- ä» Delivery ä¸­é€‰æ‹©åª’ä½“æ·»åŠ åˆ° Listing
- ç®¡ç† Listing ç°æœ‰åª’ä½“

---

## ğŸ”§ å…³é”®ç»„ä»¶

### 1. ChunkedUpload
**æ–‡ä»¶**: `components/media/chunked-upload.tsx`
- åˆ†ç‰‡ä¸Šä¼ ç»„ä»¶
- æ‹–æ‹½æ”¯æŒ
- è¿›åº¦è¿½è¸ª

### 2. MediaPicker
**æ–‡ä»¶**: `components/media/media-picker.tsx`
- æµè§ˆ Studio åª’ä½“åº“
- å•é€‰/å¤šé€‰
- é›†æˆä¸Šä¼ åŠŸèƒ½

### 3. ListingMediaManager
**æ–‡ä»¶**: `components/listings/listing-media-manager.tsx`
- Agent ä» Delivery é€‰æ‹©åª’ä½“
- æ·»åŠ åª’ä½“åˆ° Listing
- ç®¡ç† Listing åª’ä½“ï¼ˆå¾…å®Œå–„ï¼‰

### 4. DeliveriesTable
**æ–‡ä»¶**: `components/deliveries/deliveries-table.tsx`
- Deliveries åˆ—è¡¨å±•ç¤º
- çŠ¶æ€å¾½ç« 
- å¿«é€Ÿæ“ä½œ

---

## ğŸ”— API é›†æˆ

### Deliveries API
- `POST /api/delivery` - åˆ›å»º Delivery Package âœ…
- `GET /api/delivery/{id}` - è·å–è¯¦æƒ… âœ…
- `GET /api/delivery/order/{orderId}` - æŒ‰ Order æŸ¥è¯¢ âœ…
- `GET /api/delivery/listing/{listingId}` - æŒ‰ Listing æŸ¥è¯¢ âœ…
- `POST /api/delivery/{id}/items` - æ·»åŠ åª’ä½“é¡¹ âœ…
- `DELETE /api/delivery/{id}/items/{itemId}` - åˆ é™¤åª’ä½“é¡¹ âœ…
- `POST /api/delivery/{id}/publish` - å‘å¸ƒ âœ…
- `POST /api/delivery/{id}/revoke` - æ’¤é”€ âœ…

### Listings Media API
- `POST /api/listings/{id}/media` - æ·»åŠ åª’ä½“ âœ…
- `DELETE /api/listings/{id}/media/{mediaRefId}` - åˆ é™¤åª’ä½“ âœ…
- `PUT /api/listings/{id}/media/reorder` - æ’åº âœ…
- `PUT /api/listings/{id}/media/visibility` - è®¾ç½®å¯è§æ€§ âœ…

### Media API
- `POST /api/media/chunked/initiate` - åˆå§‹åŒ–åˆ†ç‰‡ä¸Šä¼  âœ…
- `POST /api/media/chunked/upload` - ä¸Šä¼ åˆ†ç‰‡ âœ…
- `POST /api/media/chunked/complete/{sessionId}` - å®Œæˆä¸Šä¼  âœ…
- `GET /api/media/studio/{studioId}` - æŸ¥è¯¢ Studio åª’ä½“ âœ…

---

## ğŸ¨ ç”¨æˆ·ä½“éªŒ

### Studio å·¥ä½œæµ
1. åœ¨ `/dashboard/orders` æŸ¥çœ‹è®¢å•
2. å®Œæˆæ‹æ‘„åï¼Œè¿›å…¥ `/dashboard/deliveries/new`
3. é€‰æ‹©è®¢å• â†’ ä¸Šä¼ ç…§ç‰‡ â†’ å‘å¸ƒ
4. Agent è‡ªåŠ¨æ”¶åˆ°é€šçŸ¥ï¼ˆå¾…å®ç°ï¼‰

### Agent å·¥ä½œæµ
1. åœ¨ `/dashboard/deliveries` æŸ¥çœ‹æ”¶åˆ°çš„ Deliveries
2. è¿›å…¥ `/dashboard/listings/{id}/edit`ï¼ŒStep 4: Media
3. é€‰æ‹© Delivery â†’ é€‰æ‹©ç…§ç‰‡ â†’ æ·»åŠ åˆ° Listing
4. è®¾ç½®å°é¢ã€è°ƒæ•´é¡ºåºã€è®¾ç½®å¯è§æ€§
5. å‘å¸ƒ Listing

---

## âœ… å·²å®ç°åŠŸèƒ½

- [x] åˆ†ç‰‡ä¸Šä¼ ç»„ä»¶
- [x] åª’ä½“é€‰æ‹©å™¨
- [x] Deliveries åˆ—è¡¨é¡µ
- [x] Delivery åˆ›å»ºé¡µï¼ˆStudioï¼‰
- [x] Delivery è¯¦æƒ…é¡µ
- [x] Listing åª’ä½“ç®¡ç†å™¨ï¼ˆAgentï¼‰
- [x] ä» Delivery æ·»åŠ åª’ä½“åˆ° Listing
- [x] Sidebar å¯¼èˆªé›†æˆ

---

## ğŸš§ å¾…å®Œå–„åŠŸèƒ½

### çŸ­æœŸ
- [ ] Deliveries åˆ—è¡¨çœŸå®æ•°æ®é›†æˆï¼ˆéœ€è¦ read APIï¼‰
- [ ] Listing å½“å‰åª’ä½“å±•ç¤ºå’Œç®¡ç†
- [ ] åª’ä½“æ’åºæ‹–æ‹½åŠŸèƒ½
- [ ] è®¾ç½®å°é¢å›¾ç‰‡
- [ ] æ‰¹é‡æ“ä½œ

### ä¸­æœŸ
- [ ] å®æ—¶é€šçŸ¥ï¼ˆDelivery å‘å¸ƒæ—¶é€šçŸ¥ Agentï¼‰
- [ ] åª’ä½“é¢„è§ˆï¼ˆå…¨å±æŸ¥çœ‹ï¼‰
- [ ] å›¾ç‰‡ç¼–è¾‘ï¼ˆè£å‰ªã€æ—‹è½¬ï¼‰
- [ ] è§†é¢‘é¢„è§ˆ

---

## ğŸ“Š æ•°æ®æµ

```
MediaAsset (Studio æ‹¥æœ‰)
    â†“
DeliveryItem (å…³è”åˆ° DeliveryPackage)
    â†“
DeliveryPackage (å…³è” Order + Listing)
    â†“
Agent é€‰æ‹©å¹¶æ·»åŠ 
    â†“
ListingMediaRef (å…³è”åˆ° Listing)
```

---

**å®ç°è€…**: AI Assistant  
**æµ‹è¯•çŠ¶æ€**: å¼€å‘ç¯å¢ƒ  
**éƒ¨ç½²çŠ¶æ€**: å¾…éƒ¨ç½²
