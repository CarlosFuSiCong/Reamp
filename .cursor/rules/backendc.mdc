---
description: "backend/**/*.cs"
alwaysApply: false
---
# C# / .NET Backend Rules

## 1. Architecture
Use three-layer architecture:
- **Controller** → HTTP endpoints only.
- **Service** → business logic.
- **Repository** → EF Core data access.

Organize by feature/domain (Users, Orders, Media, etc.).

## 2. Layer Responsibilities

### Controllers
- No business logic.
- Bind request → call service → return unified response.

### Services
- Implement business rules.
- Use repositories; no HttpContext dependency.
- Return DTO or Result type.

### Repositories
- Contain EF Core access only.
- Use async methods.

## 3. Unified API Response
- All endpoints return a consistent structure:
  `ApiResponse<T> { Success, Code, Message, Data, Errors }`

## 4. Validation
### Request Validation
- Use **FluentValidation** for request DTOs.
- Validators live inside their feature folders.

### Business Validation
- Performed inside Services.
- Use custom exceptions or Result types.

## 5. Mapping
- Use Mapster or AutoMapper.
- Feature-based mapping files.
- No business logic inside mappers.
- Do not expose sensitive fields.

## 6. EF Core Rules
- All queries through repositories.
- Prefer `AsNoTracking()` for read operations.
- Explicit decimal/date precision.
- Use migrations for schema changes.

## 7. Error Handling & Logging
- Use global exception middleware.
- Map domain errors to friendly API responses.
- Do not log sensitive data.

## 8. Async & Performance
- All I/O operations async/await.
- No `.Result` or `.Wait()`.
- Async methods end with `Async`.
